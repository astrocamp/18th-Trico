{% extends "shared/layout.html" %}
{% block content %}
<body class="bg-blue-900 font-sans">
  <div class="container mx-auto py-10 px-[10%]">
    <!-- 回上一頁按鈕 -->
    <div class="mb-4">
      <a
        class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded"
        href="javascript:history.back()"
      >
        上一頁
      </a>
    </div>

    <div class="flex bg-white rounded-lg shadow-lg overflow-hidden p-6">
      <!-- 左側為接案者介紹 -->
      <div class="w-2/3">
        <div class="flex items-center mb-6">
          <a href="">
            <img
              src="{% if service.freelancer_user.profile.photo %}{{ service.freelancer_user.profile.photo.url }}{% else %}https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp{% endif %}"
              alt="User Avatar"
              class="w-16 h-16 rounded-full mr-4 border-2 border-gray-300 shadow-sm transition-transform duration-300 hover:scale-125 hover:rotate-6"
            />
          </a>
          <div>
            <p class="text-xl font-bold text-gray-800">{{ service.freelancer_user.username }}</p>
            <div class="flex items-center text-yellow-400">
              <span class="text-lg">&#9733;&#9733;&#9733;&#9733;&#9734;</span>
              <span class="text-gray-700 text-base ml-2">4.0/5.0</span>
            </div>
          </div>
        </div>

        <h1 class="text-xl font-bold mb-4 text-gray-800">
          {{ service.title }}
        </h1>

        <div class="flex items-center">
          <img
            src="{% if service.photo %}{{ service.photo.url }}{% else %}https://fakeimg.pl/300{% endif %}"
            alt="Service Image"
            class="w-[80%] h-auto rounded-lg border shadow-sm"
          />
        </div>

        <!-- 接案者介紹:描述 -->
        <p class="text-gray-700 mb-4 text-lg">
          {{ service.description }}
        </p>

        <div class="flex flex-wrap gap-2">
          <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-s">Python</span>
          <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-s">Django</span>
          <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-s">React</span>
          <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-s">HTML5</span>
          <span class="px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-s">CSS3</span>
          <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-s">JavaScript</span>
          <span class="px-5 py-1 bg-teal-100 text-teal-700 rounded-full text-s">Web Development</span>
        </div>
      </div>

      <!-- 右側價格一般&專業方案 -->
      <div class="w-1/3 bg-gray-50 p-6 border-l">
        <div class="mb-4">
          <div class="flex border-b">
            <button
              id="standard-tab"
              class="flex-1 py-2 text-center font-semibold text-gray-700 border-b-2 border-blue-600"
            >
              一般方案
            </button>
            <button
              id="premium-tab"
              class="flex-1 py-2 text-center font-semibold text-gray-700 border-b-2"
            >
              專業方案
            </button>
          </div>
        </div>

        <div id="price-section">
          <!-- Standard Plan -->
          <div id="standard" class="block">
            <p class="text-4xl font-bold text-gray-800 mb-2">${{service.standard_price}}</p>
            <p class="text-gray-600 mb-4">
              一般版：{{service.standard_description}} 
            </p>
            <p class="text-sm text-red-500 mb-4">交付時間：{{service.standard_delivery_time}} 天</p>
          </div>

          <!-- Premium Plan -->
          <div id="premium" class="hidden">
            <p class="text-4xl font-bold text-gray-800 mb-2">${{service.premium_price}}</p>
            <p class="text-gray-600 mb-4">
              專業版：{{service.premium_description}} 
            </p>
            <p class="text-sm text-red-500 mb-4">交付時間：{{service.premium_delivery_time}} 天</p>
          </div>
        </div>
        <!-- 支付方式選擇表單 -->
        <form method="post" action="{% url 'order:payment_form_select' service.id %}">
          {% csrf_token %}
          <input type="hidden" name="plan" id="plan" value="standard" />
          <button
            type="submit"
            class="w-full bg-blue-800 text-white py-2 rounded-lg text-lg font-semibold hover:bg-blue-700 text-center block"
          >
            選擇支付方式
          </button>
        </form>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
      <h2 class="text-xl font-bold mb-4">留言板</h2>

      <!-- 顯示留言 -->
      {% for comment in comments %}
      <div class="border-b pb-4 mb-4">
        <p class="text-gray-800"><strong>{{ comment.user.username }}</strong></p>
        <p class="text-gray-600">{{ comment.content }}</p>
        <p class="text-sm text-gray-400">{{ comment.created_at|date:"Y-m-d H:i" }}</p>
        {% if comment.user == user %}
        <!-- 刪除留言按鈕 -->
        <form method="POST" action="{% url 'comments:delete_comment' comment.id %}">
          {% csrf_token %}
          <button type="submit" class="text-red-500 text-sm">刪除</button>
        </form>
        {% endif %}
      </div>
      {% empty %}
      <p class="text-gray-500">目前沒有留言，成為第一個留言者吧！</p>
      {% endfor %}

      <!-- 新增留言表單 -->
      <form method="POST" class="mt-6">
        {% csrf_token %}
        <div class="mb-4">
          <label for="content" class="block text-gray-700 font-medium mb-2">留言內容：</label>
          <textarea
            id="content"
            name="content"
            class="w-full h-20 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
            placeholder="請輸入您的留言內容"
          ></textarea>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
          新增留言
        </button>
      </form>
    </div>
  </div>

 {% load static %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
  const standardTab = document.getElementById("standard-tab");
  const premiumTab = document.getElementById("premium-tab");
  const standardSection = document.getElementById("standard");
  const premiumSection = document.getElementById("premium");

  standardTab.addEventListener("click", function () {
    standardSection.classList.remove("hidden");
    premiumSection.classList.add("hidden");
    standardTab.classList.add("border-blue-500", "text-blue-700");
    premiumTab.classList.remove("border-blue-500", "text-blue-700");
  });

  premiumTab.addEventListener("click", function () {
    premiumSection.classList.remove("hidden");
    standardSection.classList.add("hidden");
    premiumTab.classList.add("border-blue-500", "text-blue-700");
    standardTab.classList.remove("border-blue-500", "text-blue-700");
  });
});
  </script>  
</body>
{% endblock %}
