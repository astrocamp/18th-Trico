{% extends "shared/layout.html" %} 
{% block content %} 
{% load static %}

<div class="w-4/5 mx-auto my-8 bg-blue-100 p-6 rounded-lg shadow-md">
  <!-- 按鈕區域 -->
  <div class="flex justify-between items-center mb-6">
    <!-- 上一頁 -->
    <a
      class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded"
      href="{% url 'users:user_dashboard' %}">
    
      回主控台
    </a>

    <!-- 右側按鈕區域 -->
    <div class="flex space-x-4">
      <!-- 新增服務按鈕 -->
      <a
        class="add-service-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        href="{% url 'services:create_service' id=request.user.id %}"
      >
        新增服務
      </a>

      <!-- 管理個人服務按鈕 -->
      <button
        id="toggle-management-btn"
        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
      >
        管理個人服務
      </button>
    </div>
  </div>

  <!-- 卡牌區域 -->
  <div class="services grid grid-cols-1 md:grid-cols-4 gap-6">
    {% if services %}
      {% for service in services %}
      <div
        class="service-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col justify-between"
      >
        <img
          class="w-full h-48 object-cover"
          src="{% if service.photo %}{{ service.photo.url }}{% else %}https://fakeimg.pl/300{% endif %}"
          alt="Service Photo"
        />
        <div class="p-4 flex-grow">
          <h2 class="text-m font-bold text-blue-800">{{ service.title }}</h2>
          <p class="text-gray-600 mt-2">{{ service.description }}</p>
        </div>
        <div class="p-4 border-t border-gray-200">
          <div class="mt-2 flex-auto space-x-4 justify-end management-buttons hidden">
            <!-- 編輯按鈕 -->
            <a
              class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-2 px-3 rounded transition duration-300"
              href="{% url 'services:edit_service' id=request.user.id service_id=service.id %}"
            >
              編輯
            </a>
            <!-- 刪除按鈕 -->
            <a
              class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded transition duration-300"
              href="{% url 'services:delete_service' id=request.user.id service_id=service.id  %}"
            >
              刪除
            </a>
          </div>
          <span class="text-gray-500 text-xs text-right">
            {{ service.created_at|date:"Y/m/d  H:i"}} 新增完成√
          </span>
        </div>

        <!-- Comments Section -->
        <div class="p-4 border-t border-gray-300">
          <h4 class="text-blue-700 font-bold">評論:</h4>
          <ul class="text-gray-700 mt-2">
            {% for comment in service.comments.all %}
            <li class="mb-2">
              <strong>{{ comment.user.username }}</strong> 
              <span class="text-xs text-gray-500">({{ comment.created_at|date:"Y/m/d H:i" }})</span>: 
              {{ comment.content }}
              {% if comment.user == request.user %}
              <a
                class="text-red-600 text-sm hover:underline"
                href="{% url 'comments:delete_comment' comment.id %}"
              >
                刪除
              </a>
              {% endif %}
            </li>
            {% empty %}
            <p class="text-gray-500">目前還沒有評論哦~</p>
            {% endfor %}
          </ul>
          <a
            class="text-blue-500 hover:underline text-sm"
            href="{% url 'comments:add_comment' service.id %}"
          >
            新增評論
          </a>
          <!-- 卡牌內容 -->
          <div class="p-4 flex-grow">
            <h2 class="text-m font-bold text-blue-800 truncate">{{ service.title }}</h2>
            <p class="text-gray-600 mt-2 text-sm truncate">{{ service.description }}</p>
          </div>
          <!-- 卡牌底部 -->
          <div class="p-4 border-t border-gray-200">
            <div class="mt-2 flex-auto space-x-4 justify-end management-buttons hidden">
              <!-- 編輯按鈕 -->
              <a
                class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-2 px-3 rounded transition duration-300"
                href="{% url 'services:edit_service' id=request.user.id service_id=service.id %}"
              >
                編輯
              </a>
              <!-- 刪除按鈕 -->
              <a
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded transition duration-300"
                href="{% url 'services:delete_service' id=request.user.id service_id=service.id %}"
              >
                刪除
              </a>
            </div>
            <span class="text-gray-500 text-xs text-right">
              {{ service.created_at|date:"Y/m/d  H:i"}} 新增完成√
            </span>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
    <p class="text-center text-gray-700">
      您尚未新增服務哦~ <br>按下新增服務開始你的接案旅程吧~
    </p>
    {% endif %}
  </div>

  <script src="{% static 'scripts/toggling_buttons.js' %}"></script>
</div>

{% endblock %}
